<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Too Early</title>
    <link rel="icon" href="dolce-logo.png" type="image/x-icon">
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
    <script src="firebaseConfig.js"></script>
    <script src="network-check.js"></script>
    
    <style>
            body{
            background: radial-gradient(circle at center, #0a0c12 0%, #000 100%) !important;
            }

            /* --- Subtle Italian halo that rotates slooowly behind the card --- */
            @keyframes haloSpin { to { transform: rotate(360deg); } }
            @keyframes edgeSweep { 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }

            #early-message-container{
                padding: 24px !important;
                background: rgba(12,14,20,0.88) !important;   /* translucent */
                border: 1px solid rgba(255,255,255,0.08) !important;
                border-radius: 20px !important;
                box-shadow:
                    0 14px 36px rgba(0,0,0,.55),
                    inset 0 0 0 1px rgba(255,255,255,.03) !important;
                z-index: 1000 !important;  
                width: auto !important;    
                max-width: 800px !important;

                position: fixed !important; 
                top: 50px;                  
                left: 50px;                 
            }

            #early-message-container::before{
            background: none !important;   /* kill the spinning glow */
            animation: none !important;
            filter: none !important;
            opacity: 0 !important;
            }

           @keyframes traceBox {
            0%   { clip-path: polygon(0 0, 0% 0, 0% 0, 0 0); }           /* start top-left */
            25%  { clip-path: polygon(0 0, 100% 0, 100% 0, 0 0); }       /* sweep top edge */
            50%  { clip-path: polygon(0 0, 100% 0, 100% 100%, 100% 100%);}/* sweep right edge */
            75%  { clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%); } /* sweep bottom edge */
            100% { clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%); } /* sweep left edge back to start */
            }

            #early-message-container::after {
            content: "";
            position: absolute;
            inset: -1px;                 /* sit just outside the box */
            border-radius: 22px;         /* 20px corner + ring */
            padding: 2px;                /* ring thickness */

            /* Same Italian gradient you had */
            background: linear-gradient(90deg, #1db954, #ffffff, #ff4d4f, #1db954);

            /* 🔑 Show ONLY the ring, not the inside */
            -webkit-mask:
                linear-gradient(#000 0 0) content-box,
                linear-gradient(#000 0 0);
            -webkit-mask-composite: xor;
                    mask-composite: exclude;

            filter: blur(.4px);
            opacity: .65;
            animation: traceBox 5.5s linear infinite;
            pointer-events: none;
            }

            /* Logo & text remain clean */
            .logo img{
            max-width: 200px;
            margin-bottom: 18px;
            filter: drop-shadow(0 6px 14px rgba(0,0,0,.6));
            }
            h1{
            color:#f3f3f3;
            margin: 6px 0 8px;
            font-weight:900;
            letter-spacing:.2px;
            text-shadow: 0 2px 10px rgba(0,0,0,.5);
            }

            /* Countdown: keep your pulse, darker glow */
            #countdown-timer{
            text-shadow:
                0 0 12px rgba(255,77,79,.45),
                0 0 18px rgba(29,185,84,.42);
            }

            /* Respect reduced motion */
            @media (prefers-reduced-motion: reduce){
            #early-message-container::before,
            #early-message-container::after { animation: none !important; }
            }
        </style>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
            const box = document.getElementById('early-message-container');
            if (!box) return;

            // If you want to respect reduced motion, set this to true and keep the media query check.
            const IGNORE_REDUCED_MOTION = true;
            if (!IGNORE_REDUCED_MOTION) {
                const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                if (reduceMotion) return;
            }

            // Force fixed positioning + starting coords with !important
            box.style.setProperty('position', 'fixed', 'important');
            if (!box.style.left)  box.style.setProperty('left',  '50px', 'important');
            if (!box.style.top)   box.style.setProperty('top',   '50px', 'important');

            box.style.willChange = 'left, top';

            // Start from current computed position
            let x = parseFloat(getComputedStyle(box).left) || 50;
            let y = parseFloat(getComputedStyle(box).top)  || 50;

            // Pixels per ms
            let vx = 0.06;
            let vy = 0.03;

            let paused = false;
            let last = performance.now();

            function frame(now) {
                if (paused) return requestAnimationFrame(frame);

                const dt = now - last;
                last = now;

                x += vx * dt;
                y += vy * dt;

                const rect = box.getBoundingClientRect();
                const margin = 16;
                const maxX = window.innerWidth  - rect.width  - margin;
                const maxY = window.innerHeight - rect.height - margin;

                if (x < margin) { x = margin; vx = Math.abs(vx); }
                if (y < margin) { y = margin; vy = Math.abs(vy); }
                if (x > maxX)   { x = maxX;   vx = -Math.abs(vx); }
                if (y > maxY)   { y = maxY;   vy = -Math.abs(vy); }

                // Write with !important so no CSS can override
                box.style.setProperty('left', x + 'px', 'important');
                box.style.setProperty('top',  y + 'px', 'important');

                requestAnimationFrame(frame);
            }

            box.addEventListener('mouseenter', () => { paused = true; });
            box.addEventListener('mouseleave', () => {
                paused = false;
                last = performance.now();
                requestAnimationFrame(frame);
            });

            window.addEventListener('resize', () => {
                const rect = box.getBoundingClientRect();
                const margin = 16;
                x = Math.min(Math.max(margin, x), window.innerWidth  - rect.width  - margin);
                y = Math.min(Math.max(margin, y), window.innerHeight - rect.height - margin);
                box.style.setProperty('left', x + 'px', 'important');
                box.style.setProperty('top',  y + 'px', 'important');
            });

            requestAnimationFrame((t) => { last = t; frame(t); });
            });
            </script>

        </head>
        <body>
            <div id="early-message-container">
                <div class="logo">
                    <img src="dolce-logo.png" alt="Dolce Vita Gelateria Logo">
                </div>
                <h1 id="status-message">Sorry we are closed! Menu will automatically start during buisness hours</h1>
                <div id="countdown-timer" style="display: none;"></div>
            </div>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    const db = firebase.firestore();

    function fetchBusinessHours(callback) {
        db.collection("business_hours").doc("hours").get().then((doc) => {
            if (doc.exists) {
                const data = doc.data();
                console.log("📢 Fetched Business Hours for Early Page:", data);

                if (!data.openTime || !data.closeTime) {
                    console.error("❌ Missing openTime or closeTime in Firestore!");
                    return;
                }

                // Ensure openTime and closeTime are numbers
                const openTime = parseInt(data.openTime, 10);
                const closeTime = parseInt(data.closeTime, 10);

                // Convert HHMM format to hour and minute values
                const openHour = Math.floor(openTime / 100);
                const openMinute = openTime % 100;
                const closeHour = Math.floor(closeTime / 100);
                const closeMinute = closeTime % 100;

                console.log(`✅ Open Time: ${openHour}:${openMinute}`);
                console.log(`✅ Close Time: ${closeHour}:${closeMinute}`);

                callback({ openHour, openMinute, closeHour, closeMinute });
            } else {
                console.error("❌ Business hours document not found!");
            }
        }).catch((error) => console.error("❌ Firestore fetch error:", error));
    }

    function checkTime(businessHours) {
        const now = new Date();
        const day = now.getDay();
        const hours = now.getHours();
        const minutes = now.getMinutes();

        const isBusinessDay = (day === 0 || (day >= 3 && day <= 7)); // Open on Wed-Sun

        const { openHour, openMinute, closeHour, closeMinute } = businessHours;

        // Check if current time is within open hours
        const isOpenHours = isBusinessDay &&
                            (hours > openHour || (hours === openHour && minutes >= openMinute)) &&
                            (hours < closeHour || (hours === closeHour && minutes < closeMinute));

        console.log(`🕒 NOW: ${hours}:${minutes} | OPEN: ${openHour}:${openMinute} - ${closeHour}:${closeMinute} | isOpenHours: ${isOpenHours}`);
        console.log(`✅ Is Today a Business Day? ${isBusinessDay}`);

        if (isOpenHours) {
            console.log("✅ Store is OPEN - Redirecting to index.html");
            setTimeout(() => { window.location.href = "index.html"; }, 500);
        }
    }

    fetchBusinessHours(checkTime);
    setInterval(() => fetchBusinessHours(checkTime), 60000);
});
    </script>    

    <!---
    <script>
        function startCountdown(duration, callback) {
            let countdown = duration;
            const countdownTimer = document.getElementById('countdown-timer');
            countdownTimer.style.display = 'block';
            countdownTimer.textContent = `${Math.floor(countdown / 60)}:${(countdown % 60).toString().padStart(2, '0')}`;
    
            const countdownInterval = setInterval(() => {
                countdown -= 1;
                countdownTimer.textContent = `${Math.floor(countdown / 60)}:${(countdown % 60).toString().padStart(2, '0')}`;
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    callback();
                }
            }, 1000);
        }
    
        function checkTime() {
            const now = new Date();
            const day = now.getDay();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
    
            // Business hours for Wednesday and Thursday (7 AM to 8 PM) and Friday to Sunday (7 AM to 8 PM)
            const isWednesdayOrThursday = (day === 3 || day === 4);
            const isFridayToSunday = (day === 0 || (day >= 5 && day <= 6)); // Include Sunday as part of business days
            
            // Countdown period from 6:30 AM to 7:00 AM on business days
            const isCountdownPeriod = (hours === 6 && minutes >= 30) || (hours === 7 && minutes === 0);
            
            // Business hours logic
            const isOpenHoursWednesdayThursday = (hours > 7 || (hours === 7 && minutes >= 0)) && (hours < 20 || (hours === 20 && minutes === 0));
            const isOpenHoursFridayToSunday = (hours > 7 || (hours === 7 && minutes >= 0)) && (hours < 20 || (hours === 20 && minutes === 0));
    
            const isBusinessDay = isWednesdayOrThursday || isFridayToSunday;
            const isOpenHours = (isWednesdayOrThursday && isOpenHoursWednesdayThursday) || 
                                (isFridayToSunday && isOpenHoursFridayToSunday);
    
            console.log(`early.html - Current Time: ${hours}:${minutes}:${seconds}`);
            console.log(`early.html - Day of Week: ${day}`);
            console.log(`early.html - Is Business Day: ${isBusinessDay}`);
            console.log(`early.html - Countdown Period: ${isCountdownPeriod}`);
            console.log(`early.html - Open Hours: ${isOpenHours}`);
    
            if (isBusinessDay) {
                console.log(isWednesdayOrThursday ? "Time Zone: Wednesday and Thursday (7 AM to 8 PM)"
                                                  : "Time Zone: Friday-Sunday (7 AM to 8 PM)");
            }
    
            if (isOpenHours && isBusinessDay) {
                console.log("Redirecting to index.html from early.html");
                setTimeout(() => {
                    window.location.href = "index.html";
                }, 500);
            } else if (isCountdownPeriod && isBusinessDay) {
                const targetTime = new Date(now);
                targetTime.setHours(7, 0, 0, 0); // Set target to 7:00 AM
                const remainingTime = Math.floor((targetTime - now) / 1000); // in seconds
                console.log("Starting Countdown to Opening");
                startCountdown(remainingTime, () => window.location.href = "index.html");
            } else {
                console.log("Not within Business Hours or Countdown Period - Display 'Check back later!'");
                const countdownTimer = document.getElementById('countdown-timer');
                if (countdownTimer) {
                    countdownTimer.textContent = "Check back later!";
                }
            }
        }
    
        checkTime();
        setInterval(checkTime, 60000); // Check every minute
    </script> -->
    
</body>
</html>